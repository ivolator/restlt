<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="RestLt : REST done easy with PHP">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>RestLt</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ivolator/restlt">View on GitHub</a>

          <h1 id="project_title">RestLt</h1>
          <h2 id="project_tagline">REST done easy with PHP</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/ivolator/restlt/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/ivolator/restlt/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a id="a-thin-rest-full-server-implementation-in-php" class="anchor" href="#a-thin-rest-full-server-implementation-in-php" aria-hidden="true"><span class="octicon octicon-link"></span></a>A "thin" REST-full server implementation in PHP</h2>

<p>RestLt is a flexible small library that will allow you to build RESTfull service.
Most of the sub-components are extensible or replaceable. This would let you modify the server's behavior.
Any feedback is appreciated!</p>

<p><a href="https://travis-ci.org/ivolator/restlt"><img src="https://travis-ci.org/ivolator/restlt.png" alt="Build Status"></a></p>

<h2>
<a id="installing" class="anchor" href="#installing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installing</h2>

<h3>
<a id="using-composer" class="anchor" href="#using-composer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Composer</h3>

<p>In require section of your composer.json file add the information for RestLt as follows:</p>

<pre><code>{ 
        "require" :
        { 
                "restlt/restlt":"1.0.0b"
        }
}
</code></pre>

<p>Run <code>composer.phar --dev update</code></p>

<h3>
<a id="clone-with-git" class="anchor" href="#clone-with-git" aria-hidden="true"><span class="octicon octicon-link"></span></a>Clone with GIT</h3>

<p>Use this URL to clone the repo
<code>https://github.com/ivolator/restlt.git</code></p>

<h2>
<a id="basics" class="anchor" href="#basics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basics</h2>

<h3>
<a id="server-end-point-setup" class="anchor" href="#server-end-point-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server end point setup</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-c">//Get instance of the server by passing the server base url</span></span>
<span class="pl-s2"><span class="pl-vo">$s</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">Server</span> ( <span class="pl-s1"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span> );</span>
<span class="pl-s2"><span class="pl-c">//Tell the server where to find the resources</span></span>
<span class="pl-s2"><span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>registerResourceFolder ( <span class="pl-c1">SOME_APPLICATION_ROOT</span> <span class="pl-k">.</span>  <span class="pl-s1"><span class="pl-pds">'</span>/resources<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>name\space\resources<span class="pl-pds">'</span></span> );</span>
<span class="pl-s2"><span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>registerResourceClass(<span class="pl-s1"><span class="pl-pds">'</span>example\name\space\Resource<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2"><span class="pl-s3">echo</span> <span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>serve ();</span>
<span class="pl-s2"><span class="pl-k">exit</span>;</span></pre></div>

<p>In your base server directory add an .htaccess file with the follwing content</p>

<pre><code>&lt;IfModule mod_rewrite.c&gt;
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^(.*)$ index.php?_url=/$1 [QSA,L]
&lt;/IfModule&gt;
</code></pre>

<p>Now you have bootstraped RestLt.</p>

<h3>
<a id="creating-a-resource" class="anchor" href="#creating-a-resource" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a resource</h3>

<p>A resource in Rest Lite is a class that extends the \restlt\Resource class.
 Each resource can contain methods that respond to multiple GETs, POSTs, PUTs, DELETEs and PATCHs.
 It is important to mention that when you are registering resources with the server you are either registering a resource folder and providing a namespace or a single resource by providing the FQNS to resource class. Providing a FQNS (fully qualified name space) is necessary.</p>

<p>To configure the URI for the resource, you need to setup couple of things.
 All the metadata is configurable via the PHP doc blocks. Examples are shown later.</p>

<ol>
<li>Add the @resourceBaseUri in the class doc block.This will set up the base URI for all methods that will be contained in this resource
'@resourceBaseUri /user' - note the forward slash at the begining</li>
<li>Add <a href="https://github.com/method" class="user-mention">@method</a> to the doc block of the class method. This will tell the server what HTTP method this function will be responding to. For example, <code>@method POST</code> or <code>@method GET</code> will tell the server that the HTTP method is GET or POST</li>
<li>Add @methodUri value for the method URI. 

<ul>
<li>
<code>@methodUri /</code> - you can either just add the "/" or omit the annotation </li>
<li>
<code>@methodUri /list</code> - hard coded example</li>
<li>
<code>@methodUri /user/([0-9]+)</code> - regex example - always add the '()' around the regex
Note that the full URI for your resource is a combination of the server base URI, that was set during \restlt\Server initialization and the addition of @resourceBaseUri + @methodUri. In general consider the URI as of a regular expression. This is how it is evaluated and followint the preg_match() rules for binding its third parameter, whatever you surround with "()" ends up as a parameter of your method.</li>
</ul>
</li>
</ol>

<p>For example, if your complete URI ends up to be /account/([0-9]+)/contact/([a-z]+), your method should be accepting 2 parameters. The first of which will be a sequence of digits and the second one letters.</p>

<p>A resource can have multiple methods that respond to GET, POST, etc.</p>

<h3>
<a id="a-simple-resource-example" class="anchor" href="#a-simple-resource-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>A simple resource example</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">namespace</span> <span class="pl-en">restlt\examples\resources</span>;</span>
<span class="pl-s2"><span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c"> * </span></span>
<span class="pl-s2"><span class="pl-c"> * @resourceBaseUri /resource1</span></span>
<span class="pl-s2"><span class="pl-c"> */</span></span>
<span class="pl-s2"><span class="pl-st">class</span> <span class="pl-en">Resource1</span> <span class="pl-s">extends</span> <span class="pl-s3">\restlt\</span><span class="pl-e">Resource</span> {</span>
<span class="pl-s2"></span>
<span class="pl-s2">    <span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">     * Note that the regex in "()" gets converted to a parameter of the method</span></span>
<span class="pl-s2"><span class="pl-c">     * Since v 1.1.0a this user comment section will appear in a simple HTML format</span></span>
<span class="pl-s2"><span class="pl-c">     * accesible at the root of ther server like this: http://url.com/approot.html</span></span>
<span class="pl-s2"><span class="pl-c">     * @method GET</span></span>
<span class="pl-s2"><span class="pl-c">     * @methodUri /([0-9]+)</span></span>
<span class="pl-s2"><span class="pl-c">     */</span></span>
<span class="pl-s2">    <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">getMe</span>(<span class="pl-vo">$id</span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>) {</span>
<span class="pl-s2">        <span class="pl-vo">$obj</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">\stdClass</span> ();</span>
<span class="pl-s2">        <span class="pl-vo">$obj</span><span class="pl-k">-&gt;</span><span class="pl-vo">a</span> <span class="pl-k">=</span> <span class="pl-st">array</span> (<span class="pl-c1">9</span>,<span class="pl-c1">8</span>,<span class="pl-c1">7</span>);</span>
<span class="pl-s2">        <span class="pl-c">//obtain the "someParam" - from POST or GET</span></span>
<span class="pl-s2">        <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>get ( <span class="pl-s1"><span class="pl-pds">'</span>someParam<span class="pl-pds">'</span></span>,<span class="pl-vo">$defaultValueIfParamIsMissing</span> );</span>
<span class="pl-s2">        <span class="pl-k">return</span> <span class="pl-vo">$boj</span>;</span>
<span class="pl-s2">    }</span>
<span class="pl-s2">    <span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">     *</span></span>
<span class="pl-s2"><span class="pl-c">     * @method PUT</span></span>
<span class="pl-s2"><span class="pl-c">     * @methodUri /save</span></span>
<span class="pl-s2"><span class="pl-c">     */</span></span>
<span class="pl-s2">    <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">putMe</span>() {</span>
<span class="pl-s2">        <span class="pl-c">//fetch the parameters from the query string</span></span>
<span class="pl-s2">        <span class="pl-vo">$params</span> <span class="pl-k">=</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">request</span><span class="pl-k">-&gt;</span>getQueryParams ();</span>
<span class="pl-s2">        <span class="pl-vo">$params</span> <span class="pl-k">=</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">request</span><span class="pl-k">-&gt;</span>getPostParams ();</span>
<span class="pl-s2"></span>
<span class="pl-s2">        <span class="pl-c">//get the raw data</span></span>
<span class="pl-s2">        <span class="pl-vo">$postPayload</span><span class="pl-k">=</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">request</span><span class="pl-k">-&gt;</span>getRawPost ();</span>
<span class="pl-s2">            <span class="pl-k">......</span></span>
<span class="pl-s2">        <span class="pl-c">//return whatever you want</span></span>
<span class="pl-s2">        <span class="pl-k">return</span> <span class="pl-vo">$res</span>;</span>
<span class="pl-s2">    }</span>
<span class="pl-s2">}</span></pre></div>

<p>For the just coded resource we have created two methods, <code>Resource1::getMe()</code> and <code>Resource1::putMe()</code>. There is no naming convention for the methods. The names are chosen for better clarity. The method Resource1::get() we will be responding to the 'GET' http method and the URI that will access it is /resource1/123 or any number as per the regex. The latter URI will be prepended with the Server base URI. You set the Server base URI when instantiating the \restlt\Server.</p>

<p>Similar to the 'GET' we have built the 'PUT' method  <code>Resource1::putMy()</code>. When the server receives a 'PUT'  request and the URI is /resource1/save the  <code>Resource1::putMe()</code> method will respond with whatever you decide to return.
The methods must return data in order for you to receive it as a XML or JSON formatted string at the client.
The JSON or XML conversion happens automatically. More on adding your own twist to the output will be discussed in the advanced section.</p>

<h3>
<a id="accessing-the-get-post-and-raw-data-within-the-resources-methods" class="anchor" href="#accessing-the-get-post-and-raw-data-within-the-resources-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accessing the GET, POST and raw data within the resources' methods.</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-c">//accessing GET</span></span>
<span class="pl-s2">        <span class="pl-vo">$params</span> <span class="pl-k">=</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">request</span><span class="pl-k">-&gt;</span>getQueryParams ();</span>
<span class="pl-s2"><span class="pl-c">//accessing POST</span></span>
<span class="pl-s2">        <span class="pl-vo">$params</span> <span class="pl-k">=</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">request</span><span class="pl-k">-&gt;</span>getPostParams ();</span></pre></div>

<p>Get the raw data as it was submited in the body</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">        <span class="pl-vo">$postPayload</span><span class="pl-k">=</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">request</span><span class="pl-k">-&gt;</span>getRawPost (); </span></pre></div>

<p>Get one parameter at a time</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">        <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>get(<span class="pl-vo">$paramName</span>);</span></pre></div>

<p>Obtain the parameter ($_REQUEST) and at the same time provide a default value. This helps you avoid the checks for set or empty values</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">        <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>get(<span class="pl-s1"><span class="pl-pds">'</span>page<span class="pl-pds">'</span></span>,<span class="pl-c1">1</span>);</span></pre></div>

<h3>
<a id="public-api-documentation" class="anchor" href="#public-api-documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Public API documentation</h3>

<p>If you added User comments to the API resource methods, now you can access them by going to the root of the server.
<code>http://myserveurl.com/serverroot.html</code>
Where the <code>serverroot</code> is the base URI you have defined when initializing the \restlt\Server object.</p>

<h2>
<a id="handling-errors" class="anchor" href="#handling-errors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Handling errors</h2>

<h3>
<a id="exceptions" class="anchor" href="#exceptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exceptions</h3>

<p>All exceptions thrown by the server will end up as 404 or 500 errors.
If you throw your own error the result code will be 500, but you have the controll of what gets thrown or caught. 
The message resulting from the latter will be sent to the server in the error object as part of the result.
For example if you throw <code>throw new \Exception('My Error',1000);</code> you will get the follwing in the response body.
The HTTP status code however will be 500.</p>

<div class="highlight highlight-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s1"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s1"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">result</span>&gt;
  &lt;<span class="pl-ent">errors</span>&gt;
    &lt;<span class="pl-ent">error</span>&gt;
      &lt;<span class="pl-ent">error</span>&gt;
        &lt;<span class="pl-ent">message</span>&gt;My Error&lt;/<span class="pl-ent">message</span>&gt;
        &lt;<span class="pl-ent">code</span>&gt;1000&lt;/<span class="pl-ent">code</span>&gt;
      &lt;/<span class="pl-ent">error</span>&gt;
    &lt;/<span class="pl-ent">error</span>&gt;
  &lt;/<span class="pl-ent">errors</span>&gt;
&lt;/<span class="pl-ent">result</span>&gt;</pre></div>

<h3>
<a id="phpuser-errors" class="anchor" href="#phpuser-errors" aria-hidden="true"><span class="octicon octicon-link"></span></a>PHP/user errors</h3>

<p>Errors caused by  E_ERROR, E_USER_ERROR, E_WARNING, E_USER_WARNING, E_CORE_ERROR, E_CORE_WARNING, E_DEPRECATED and E_STRICT will end up as 500. You can see this error in the php error log.  </p>

<h2>
<a id="some-advanced-usage" class="anchor" href="#some-advanced-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Some advanced usage</h2>

<h3>
<a id="event-hooks" class="anchor" href="#event-hooks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Event Hooks</h3>

<p>Let's say you need to add some twist to the execution flow or put some checks, logging or whatever comes to mind. There are three event hooks that provide a way to do that. The callbacks provided to these event hooks need to be Callable. The method or function signatures are provided bellow.</p>

<h3>
<a id="on-before-event----before-the-flow-enters-your-resource-method-" class="anchor" href="#on-before-event----before-the-flow-enters-your-resource-method-" aria-hidden="true"><span class="octicon octicon-link"></span></a>On Before event - * before the flow enters your resource method. *</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-st">class</span> <span class="pl-en">Resource1</span> <span class="pl-s">extends</span> <span class="pl-s3">\restlt\</span><span class="pl-e">Resource</span> {</span>
<span class="pl-s2">    <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-s3">__construct</span>() {</span>
<span class="pl-s2">        <span class="pl-vo">$f1</span> <span class="pl-k">=</span> <span class="pl-st">function</span> (<span class="pl-vo">$r</span>) {</span>
<span class="pl-s2">             <span class="pl-c">//do something</span></span>
<span class="pl-s2">        };</span>
<span class="pl-s2">        <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>on ( <span class="pl-s3">Resource</span><span class="pl-k">::</span><span class="pl-c1">ON_BEFORE</span>, <span class="pl-s1"><span class="pl-pds">'</span>myFunctionName<span class="pl-pds">'</span></span>, <span class="pl-vo">$f1</span> );</span>
<span class="pl-s2">    }</span></pre></div>

<p>or instead of a closure, pass a Callable</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">    <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>on ( <span class="pl-s3">Resource</span><span class="pl-k">::</span><span class="pl-c1">ON_BEFORE</span>, <span class="pl-s1"><span class="pl-pds">'</span>myFunctionName<span class="pl-pds">'</span></span>, <span class="pl-s3">array</span>(<span class="pl-vo">$obj</span>,<span class="pl-vo">$method</span>) );</span>
<span class="pl-s2">    }</span></pre></div>

<p>The callback function provided for this event has the following signature</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">    <span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@param</span> \restlt\Request $r </span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s2"><span class="pl-c">     * /</span></span>
<span class="pl-s2"><span class="pl-c"><span class="pl-ii">    $f = function (\restlt\Request $r){};</span></span></span></pre></div>

<h3>
<a id="on-after-event----after-the-resource-function-returns-" class="anchor" href="#on-after-event----after-the-resource-function-returns-" aria-hidden="true"><span class="octicon octicon-link"></span></a>On After event - * after the resource function returns *</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>on ( <span class="pl-s3">Resource</span><span class="pl-k">::</span><span class="pl-c1">ON_AFTER</span>, <span class="pl-s1"><span class="pl-pds">'</span>myFunctionName<span class="pl-pds">'</span></span>, <span class="pl-s3">array</span>(<span class="pl-vo">$obj</span>,<span class="pl-vo">$method</span>) );</span></pre></div>

<pre><code>* The callback function provided for this event has the following signature *
</code></pre>

<div class="highlight highlight-php"><pre><span class="pl-s2">    <span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@param</span> \restlt\Request $request </span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@param</span> \restlt\Response $response</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@param</span> mixed $return the result of your resource method</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s2"><span class="pl-c">     * /</span></span>
<span class="pl-s2"><span class="pl-c"><span class="pl-ii">    $f = function (\restlt\Request $request, \restlt\Response $response, $return){};</span></span></span></pre></div>

<h3>
<a id="on-error----when-an-error-occurs-inside-the-method-" class="anchor" href="#on-error----when-an-error-occurs-inside-the-method-" aria-hidden="true"><span class="octicon octicon-link"></span></a>On error - * when an error occurs inside the method *</h3>

<p>If you throw an exception within a method it will get eventually caught in the top layer and you'll get 500. This event actually is triggered when E_ERROR,E_USER_ERROR,E_WARNING,E_USER_WARNING,E_CORE_ERROR,E_CORE_WARNING,E_DEPRECATED,E_STRICT are thrown.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2">    <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>on ( <span class="pl-s3">Resource</span><span class="pl-k">::</span><span class="pl-c1">ON_ERROR</span>, <span class="pl-s1"><span class="pl-pds">'</span>myFunctionName<span class="pl-pds">'</span></span>, <span class="pl-s3">array</span>(<span class="pl-vo">$obj</span>,<span class="pl-vo">$method</span>) );</span></pre></div>

<p>Follows the callback function signature</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">* <span class="pl-k">@param</span> \restlt\Request $r </span></span>
<span class="pl-s2"><span class="pl-c">* <span class="pl-k">@param</span> \restlt\Response $r</span></span>
<span class="pl-s2"><span class="pl-c">* <span class="pl-k">@return</span> \Exception $exception - the result of your resource method</span></span>
<span class="pl-s2"><span class="pl-c">* <span class="pl-k">@return</span> void</span></span>
<span class="pl-s2"><span class="pl-c">* /</span></span>
<span class="pl-s2"><span class="pl-c"><span class="pl-ii">$f = function (\restlt\Request $request, \restlt\Response $response,\Exception $exception){};</span></span></span></pre></div>

<h2>
<a id="register-event-examples" class="anchor" href="#register-event-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>register event examples:</h2>

<h3>
<a id="register-on_before-event-hook-for-a-specific-resource-method" class="anchor" href="#register-on_before-event-hook-for-a-specific-resource-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>Register ON_BEFORE event hook for a specific resource method</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2">        <span class="pl-vo">$f1</span> <span class="pl-k">=</span> <span class="pl-st">function</span> (<span class="pl-vo">$r</span>) {</span>
<span class="pl-s2">        <span class="pl-c">//do something</span></span>
<span class="pl-s2">        };</span>
<span class="pl-s2">        <span class="pl-c">//the context here is the Resource, hence $this</span></span>
<span class="pl-s2">        <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>on (<span class="pl-s3">\restlt\</span><span class="pl-s3">Resource</span><span class="pl-k">::</span><span class="pl-c1">ON_BEFORE</span>, <span class="pl-s1"><span class="pl-pds">'</span>getMe<span class="pl-pds">'</span></span>, <span class="pl-vo">$f1</span> );</span></pre></div>

<h3>
<a id="register-on_before-event-hook-for-any-resource-method" class="anchor" href="#register-on_before-event-hook-for-any-resource-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>Register ON_BEFORE event hook for ANY resource method</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2">        <span class="pl-vo">$f1</span> <span class="pl-k">=</span> <span class="pl-st">function</span> (<span class="pl-vo">$r</span>) {</span>
<span class="pl-s2">        <span class="pl-c">//do something</span></span>
<span class="pl-s2">        };</span>
<span class="pl-s2">        <span class="pl-c">//the context here is the Resource, hence $this</span></span>
<span class="pl-s2">        <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>on (<span class="pl-s3">\restlt\</span><span class="pl-s3">Resource</span><span class="pl-k">::</span><span class="pl-c1">ON_BEFORE</span>, <span class="pl-c1">NULL</span>, <span class="pl-vo">$f1</span> );</span></pre></div>

<h2>
<a id="adding-some-cache" class="anchor" href="#adding-some-cache" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding some cache</h2>

<p>Since the addition of a great amound of resources could cost us in performance, RestLt uses some caching to aleviate this issue.
In it's most basic implementation the server supports natively Memcached extention. However there are ways to add third party caching systems that are already supporting multitude of backend cache adapters.
In order to use any of the two third party implementations supported by RestLt you shuld install them via <a href="getcomposer.org">Composer</a>.
When installing RestLt via <a href="getcomposer.org">Composer</a> you should have seen suggestions for either one of those.</p>

<h3>
<a id="using-built-in-memcached-implementation" class="anchor" href="#using-built-in-memcached-implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using built in Memcached implementation</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2">    <span class="pl-vo">$memcached</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">Memcached</span> ();</span>
<span class="pl-s2">    <span class="pl-vo">$memcached</span><span class="pl-k">-&gt;</span>addServer ( <span class="pl-s1"><span class="pl-pds">'</span>localhost<span class="pl-pds">'</span></span>, <span class="pl-c1">11211</span> );</span>
<span class="pl-s2">    <span class="pl-vo">$s</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">Server</span> ( <span class="pl-s1"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span> );</span>
<span class="pl-s2">    <span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>setCacheAdapter ( <span class="pl-k">new</span> <span class="pl-s3">\restlt\cache\</span><span class="pl-s3">RestltMemcachedAdapter</span>( <span class="pl-vo">$memcached</span> ) );</span>
<span class="pl-s2">    <span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>serve ();</span></pre></div>

<h3>
<a id="using-zend-cache-component---zend-cache" class="anchor" href="#using-zend-cache-component---zend-cache" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Zend Cache component - <a href="http://framework.zend.com/manual/2.0/en/modules/zend.cache.storage.adapter.html">Zend Cache</a>
</h3>

<p>If you are already using ZF2 caching component there is an easy way to add it to RestLt.
Here assuming that you know how to use <code>Zend\Cache\StorageFactory::adapterFactory</code> you need to obtain a
StorageAdapter. </p>

<div class="highlight highlight-php"><pre><span class="pl-s2">    <span class="pl-vo">$zendCache</span> <span class="pl-k">=</span> <span class="pl-s3">Zend\Cache\</span><span class="pl-s3">StorageFactory</span><span class="pl-k">::</span>adapterFactory(<span class="pl-s1"><span class="pl-pds">'</span>apc<span class="pl-pds">'</span></span>,<span class="pl-vo">$options</span>);</span>
<span class="pl-s2">    <span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>setCacheAdapter ( <span class="pl-k">new</span> <span class="pl-s3">\restlt\cache\</span><span class="pl-s3">ZFCacheAdapter</span> ( <span class="pl-vo">$zendCache</span> ) );</span></pre></div>

<h3>
<a id="using-doctrines-cache-implementation---doctrine-cache" class="anchor" href="#using-doctrines-cache-implementation---doctrine-cache" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Doctrine's cache implementation - <a href="http://docs.doctrine-project.org/en/latest/reference/caching.html">Doctrine Cache</a>
</h3>

<pre><code>Here you should know how to obtain a Doctrine CacheProvider.
</code></pre>

<div class="highlight highlight-php"><pre><span class="pl-s2">    <span class="pl-vo">$memcache</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">Memcache</span>();</span>
<span class="pl-s2">    <span class="pl-vo">$memcache</span><span class="pl-k">-&gt;</span>connect(<span class="pl-s1"><span class="pl-pds">'</span>memcache_host<span class="pl-pds">'</span></span>, <span class="pl-c1">11211</span>);</span>
<span class="pl-s2">    <span class="pl-vo">$doctrineCacheProvider</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">\Doctrine\Common\Cache\</span><span class="pl-s3">MemcacheCache</span>();</span>
<span class="pl-s2">    <span class="pl-vo">$doctrineCacheProvider</span><span class="pl-k">-&gt;</span>setMemcache(<span class="pl-vo">$memcache</span>);</span>
<span class="pl-s2">    <span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>setCacheAdapter ( <span class="pl-k">new</span> <span class="pl-s3">\restlt\cache\</span><span class="pl-s3">DoctrineCacheAdapter</span>(<span class="pl-vo">$doctrineCacheProvider</span>) );</span></pre></div>

<h3>
<a id="addig-your-favorite-cache-implementation" class="anchor" href="#addig-your-favorite-cache-implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Addig your favorite cache implementation</h3>

<p>If you don't use any of the formerly mentioned cache implementations by Zend or Doctrine you can add your own.
In order for us to be able to use a third party Cache library we need to create a class that implements <code>restlt\cache\CacheAdapterInterface</code></p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-st">class</span> <span class="pl-en">OtherframeworkCacheAdapter</span> <span class="pl-s">implements</span> <span class="pl-e">CacheAdapterInterface</span> {</span>
<span class="pl-s2">        <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-s3">__construct</span>(<span class="pl-vo">$cacheInstance</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>) {</span>
<span class="pl-s2">                <span class="pl-c">// </span></span>
<span class="pl-s2">        }</span>
<span class="pl-s2">        <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">test</span>(<span class="pl-vo">$key</span>) {</span>
<span class="pl-s2">                <span class="pl-c">//</span></span>
<span class="pl-s2">        }</span>
<span class="pl-s2"></span>
<span class="pl-s2">        <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">set</span>(<span class="pl-vo">$key</span>, <span class="pl-vo">$item</span>) {</span>
<span class="pl-s2">                <span class="pl-c">//</span></span>
<span class="pl-s2">        }</span>
<span class="pl-s2"></span>
<span class="pl-s2">        <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">get</span>(<span class="pl-vo">$key</span>) {</span>
<span class="pl-s2">                <span class="pl-c">//</span></span>
<span class="pl-s2">        }</span>
<span class="pl-s2">}</span></pre></div>

<p>Now you have to tell the server to use it in your bootsrap routine.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>setCacheAdapter ( <span class="pl-k">new</span> <span class="pl-s3">\restlt\cache\</span><span class="pl-s3">OtherfameworkCacheAdapter</span>(<span class="pl-vo">$otherframeworkInstance</span>) );</span></pre></div>

<h2>
<a id="adding-your-own-annotations-to-the-resource-methods-or-the-resource-classes" class="anchor" href="#adding-your-own-annotations-to-the-resource-methods-or-the-resource-classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding your own annotations to the Resource methods or the Resource classes</h2>

<p>If you need to lock some data needed for processing during request execution you can add a custom annotation to your methods.
Here is an example how to you could use that feature.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c"> * @method POST</span></span>
<span class="pl-s2"><span class="pl-c"> * @baseUri /save</span></span>
<span class="pl-s2"><span class="pl-c"> * @allowedRoles admin, mega-admin</span></span>
<span class="pl-s2"><span class="pl-c"> */</span></span>
<span class="pl-s2"> <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">saveUser</span>(){</span>
<span class="pl-s2">     <span class="pl-vo">$roles</span> <span class="pl-k">=</span> <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span><span class="pl-vo">annotations</span><span class="pl-k">-&gt;</span>get(<span class="pl-s1"><span class="pl-pds">'</span>allowedRoles<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2">     <span class="pl-c">//do something here with the data. $roles now has the string 'admin, mega-admin'</span></span>
<span class="pl-s2">     <span class="pl-k">return</span> <span class="pl-vo">$something</span>;</span>
<span class="pl-s2"> }</span></pre></div>

<h2>
<a id="in-need-for-custom-output" class="anchor" href="#in-need-for-custom-output" aria-hidden="true"><span class="octicon octicon-link"></span></a>In need for custom output?</h2>

<p>Out of the box RestLt comes with json and xml output strategies. 
Let's say you need to provide some home grown obfuscated or even encrypted reponse. 
For whatever the reason is, you might want to do that one day.
It could be that you want to communicate with the client via some specific protocol and want to wrap the data in it. 
Or may be want to change the current ones. Here is how.</p>

<h3>
<a id="adding-a-custom-response-of-your-own" class="anchor" href="#adding-a-custom-response-of-your-own" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding a custom response of your own.</h3>

<p>First we need to create a class that implements the <code>\restlt\output\TypeConversionStrategyInterface</code>. Let's start.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">namespace</span> <span class="pl-en">my\name\space</span>;</span>
<span class="pl-s2"><span class="pl-st">class</span> <span class="pl-en">SerializeOutputStrategy</span> <span class="pl-s">implements</span> <span class="pl-s3">\restlt\output\</span><span class="pl-e">TypeConversionStrategyInterface</span> {</span>
<span class="pl-s2">    <span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@see</span> \restlt\output\TypeConversionStrategyInterface::execute()</span></span>
<span class="pl-s2"><span class="pl-c">     */</span></span>
<span class="pl-s2">    <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">execute</span>(<span class="pl-s3">\restlt\</span><span class="pl-s3">Result</span> <span class="pl-vo">$data</span>) {</span>
<span class="pl-s2">        <span class="pl-k">return</span> <span class="pl-s3">serialize</span>(<span class="pl-vo">$data</span>);</span>
<span class="pl-s2">    }</span>
<span class="pl-s2">}</span></pre></div>

<p>That's it. We have implemented a serializer sutput strategy for our RestLt server.
Next on the list to make this work is to tell the server about it.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>getResponse()<span class="pl-k">-&gt;</span>addResponseOutputStrategies(<span class="pl-s1"><span class="pl-pds">'</span>sphp<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>\my\name\space\SerializeOutputStrategy<span class="pl-pds">'</span></span>);</span></pre></div>

<p>What we did here is the follwoing. We let the server know that if we encounter '.sphp' extension in our URL we will respond with the associated output, in this case <code>SerializeOutputStrategy</code>.
Now all of your request ( GET, POST, PUT, PATCH ...) with URLs such like:</p>

<ul>
<li>
<code>http://example.com/my/path/123.sphp</code> </li>
<li>
<code>http://example.com/my/path.sphp?q=stuff</code> </li>
</ul>

<p>etc. will respond with serialized data accoring to your new output strategy.</p>

<h3>
<a id="extending-the-currently-available-restltoutputxmltypeconverter-and-restltoutputjsontypeconverter" class="anchor" href="#extending-the-currently-available-restltoutputxmltypeconverter-and-restltoutputjsontypeconverter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extending the currently available <code>\restlt\output\XmlTypeConverter</code> and <code>\restlt\output\JsonTypeConverter</code>.</h3>

<p>To modify the behaviour of the current JSON or XMl converters, you will need to extend them. There is not much to remember here. Extending the class is nothing different than what you do with any other class you do extend.
However you need to register your new class with the server and associate it with the XML or JSON types.</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>getResponse()<span class="pl-k">-&gt;</span>addResponseOutputStrategies(<span class="pl-s1"><span class="pl-pds">'</span>xml<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>\my\name\space\MyXmlStrategy<span class="pl-pds">'</span></span>);</span></pre></div>

<p>Now all requests of the kind <code>http://example.com/my/path.xml?q=stuff</code> will be processed by your new class.
Also,client requests that are made with 'Content-type:application/xml' will be processed by it too. 
the same goes if you decide to extend the json converter.</p>

<h2>
<a id="doc-block-meta-reference" class="anchor" href="#doc-block-meta-reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>Doc block Meta reference</h2>

<table>
<thead>
<tr>
<th>Annotation</th>
<th align="center">Where</th>
<th align="right">Required</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>@resourceBaseUri</td>
<td align="center">CLASS</td>
<td align="right">YES</td>
<td>string</td>
</tr>
<tr>
<td>@baseUri</td>
<td align="center">METHDO</td>
<td align="right">NO</td>
<td>string/regex or empty</td>
</tr>
<tr>
<td>@cacheControlMaxAge</td>
<td align="center">METHOD</td>
<td align="right">NO</td>
<td>integer</td>
</tr>
<tr>
<td><a href="https://github.com/method" class="user-mention">@method</a></td>
<td align="center">METHOD</td>
<td align="right">YES</td>
<td>GET, POST, PUT, PATCH, DELETE</td>
</tr>
</tbody>
</table>

<h3>
<a id="resource-class-doc-block" class="anchor" href="#resource-class-doc-block" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resource class doc block</h3>

<pre><code>@resourceBaseUri -&gt; specifies the resource base URI relative to the Server base URI
</code></pre>

<h3>
<a id="resource-method-doc-block" class="anchor" href="#resource-method-doc-block" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resource method doc block</h3>

<pre><code>@method -&gt; specifies what HTTP method this resource method respnds to. POST, GET, PUT, PATCH, DELETE are allowed
@methodBaseUri -&gt; URI relative to the resource base uri value specified in the @resourceBaseUri
@cacheControlMaxAge -&gt; this value directly affects the 'Cache-Control max-age' HTTP header value and has nothing to do with the local caching feature  
</code></pre>

<h2>
<a id="logging" class="anchor" href="#logging" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logging</h2>

<p>As of version 1.2.0-alpha there is a way to add a logger.
Added was <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-3-logger-interface.md">PSR-3</a> compatible logger. However a native logger implementation is not and probably will not be added.
You will need to inject your logger which should implement Psr\Log\LoggerInterface .</p>

<pre><code>$server-&gt;setLog($yourcustomLogger);
</code></pre>

<p>An adapter for the Zend Logger will be added when this version is released.</p>

<h2>
<a id="misc-usage-tricks" class="anchor" href="#misc-usage-tricks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Misc. usage tricks</h2>

<h3>
<a id="forcing-the-server-to-respond-always-with-spcified-reponse-type-regardles-of-the-request-content-type" class="anchor" href="#forcing-the-server-to-respond-always-with-spcified-reponse-type-regardles-of-the-request-content-type" aria-hidden="true"><span class="octicon octicon-link"></span></a>Forcing the server to respond always with spcified reponse type regardles of the request <code>Content-type</code>
</h3>

<p>The default behavior is specified by the Accept header. If the 'Accept' is plain/text or anything that does not refer to SML of JSON the
default response will be returned in JSON.
1. Force response type for all Resources registered with the server to respond with XML or JSON</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$s</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">\restlt\</span><span class="pl-s3">Server</span>(<span class="pl-s1"><span class="pl-pds">'</span>base/uri<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2"><span class="pl-vo">$s</span><span class="pl-k">-&gt;</span>getResponse()<span class="pl-k">-&gt;</span>setForceResponseType(<span class="pl-s3">Response</span><span class="pl-k">::</span><span class="pl-c1">APPLICATION_JSON</span>);</span></pre></div>

<ol>
<li>Forcing a method to always respond with XML or JSON.</li>
</ol>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c"> * @resourceBaseUri /entity</span></span>
<span class="pl-s2"><span class="pl-c"> */</span></span>
<span class="pl-s2"><span class="pl-st">class</span> <span class="pl-en">myResource</span> <span class="pl-s">extends</span> <span class="pl-s3">\restlt\</span><span class="pl-e">Resource</span></span>
<span class="pl-s2"><span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c"> * @methodUri /submit</span></span>
<span class="pl-s2"><span class="pl-c"> * @method POST</span></span>
<span class="pl-s2"><span class="pl-c"> */</span></span>
<span class="pl-s2">public function myMethod(){</span>
<span class="pl-s2">    <span class="pl-vo">$this</span><span class="pl-k">-&gt;</span>getResponse()<span class="pl-k">-&gt;</span>setForceResponseType(<span class="pl-s3">\restlt\</span><span class="pl-s3">Response</span><span class="pl-k">::</span><span class="pl-c1">APPLICATION_XML</span>);</span>
<span class="pl-s2">    <span class="pl-c">#some code here ...</span></span>
<span class="pl-s2">    <span class="pl-k">return</span> <span class="pl-vo">$result</span>;</span>
<span class="pl-s2">}</span></pre></div>

<ol>
<li>Non-coding trick to force desired response
When creating the URL for the client simply append to the end of the URI (not the  query part) .json or .xml

<ul>
<li>'GET' request - <a href="http://example.com/user/list.json?p=1&amp;q=sam">http://example.com/user/list.json?p=1&amp;q=sam</a>
</li>
<li>'POST' request - <a href="http://example.com/user.json">http://example.com/user.json</a>
</li>
<li>'GET' request - <a href="http://example.com/user/103.xml">http://example.com/user/103.xml</a> - get user resource with XML. not te integer 103 will be preserved as part of the URI and will be passed along to your method if it was defined as a regex in the meta for the resource method</li>
</ul>
</li>
</ol>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">RestLt maintained by <a href="https://github.com/ivolator">ivolator</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-45407810-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
